{
	"name": "MRP_Demand_Snapshot",
	"properties": {
		"folder": {
			"name": "MRP_Demand_Snapshot"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_csv_input",
						"type": "DatasetReference"
					},
					"name": "MRPWorkbenchwithOnhandMRPearly"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_csv_output",
						"type": "DatasetReference"
					},
					"name": "sinkToCsv"
				}
			],
			"transformations": [
				{
					"name": "selectingDesiredColumns"
				},
				{
					"name": "filteringDemand"
				},
				{
					"name": "selectingFinalColumns"
				},
				{
					"name": "AddingUpColumns"
				},
				{
					"name": "CalculatingQtyCountOfOrderNumber"
				},
				{
					"name": "derivedColumn1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          Action as string,",
				"          {Alternate Bom Designator} as string,",
				"          {Alternate Routing Designator} as string,",
				"          Applied as string,",
				"          {Avg Item Cost} as double,",
				"          {Award Classification} as string,",
				"          {Award Group} as string,",
				"          {BOM Item Type} as string,",
				"          {Build In Wip Flag} as boolean,",
				"          {Build Sequence} as string,",
				"          Buyer as string,",
				"          {Buyer Org} as string,",
				"          {Buyer Type} as string,",
				"          {Cfm Routing Flag} as string,",
				"          {Change Notice} as string,",
				"          {Component Revision} as short,",
				"          {Compression Days} as short,",
				"          {Cum Manufacturing Lead Time} as string,",
				"          {Cumulative Total Lead Time} as short,",
				"          Date as date,",
				"          {Date Published} as timestamp,",
				"          {Days From Today} as short,",
				"          Division as short,",
				"          {Extended Cost} as double,",
				"          {Extended Cost (ABS)} as double,",
				"          {Firm Planned Type} as string,",
				"          {First Unit Start Date} as string,",
				"          {Fiscal Date} as date,",
				"          {Fixed Lead Time} as short,",
				"          {Full Pegging} as short,",
				"          {Implement As Text} as string,",
				"          {Implement Date} as string,",
				"          {Implement Employee Id} as string,",
				"          {Implement Quantity Rate} as string,",
				"          {Implementation Date} as timestamp,",
				"          {Implemented Quantity} as string,",
				"          {In Source Plan} as short,",
				"          {Inventory Item Id} as integer,",
				"          {Item Avg Cost} as double,",
				"          {Item Description} as string,",
				"          {Item MRP Plan} as string,",
				"          {Item Number} as string,",
				"          {Item Planning Cat Code} as string,",
				"          {Item Purchasable Flag} as boolean,",
				"          {Item Rev} as string,",
				"          {Item Status Code} as string,",
				"          {Item Type} as string,",
				"          {Last Unit Completion Date} as string,",
				"          {Last Unit Start Date} as string,",
				"          {Line Code} as string,",
				"          {List Price} as double,",
				"          {Locator Id} as string,",
				"          {Lot Number} as string,",
				"          {Lot Status} as string,",
				"          {Make Buy} as string,",
				"          Manager as string,",
				"          {Mrp Planning Method} as string,",
				"          Nettable as string,",
				"          {New Date} as string,",
				"          {New Quantity} as string,",
				"          {Old Dock Date} as date,",
				"          {Old Due Date} as date,",
				"          {Old Order Quantity} as short,",
				"          {On Hand Qty} as short,",
				"          {Order Number} as string,",
				"          {Order Type} as string,",
				"          Org as string,",
				"          {Organization Id} as short,",
				"          {Planner Code} as string,",
				"          {Planning Group Quantity} as string,",
				"          {PO Price} as string,",
				"          {Postprocessing Lead Time} as short,",
				"          {Preprocessing Lead Time} as short,",
				"          {Process Days} as string,",
				"          {Processing Lead Time} as short,",
				"          {Product Line} as string,",
				"          {Product Line Segment} as string,",
				"          {Product Segment} as string,",
				"          Project as string,",
				"          {Project Business Area} as string,",
				"          {Project Manager Name} as string,",
				"          {Project Name} as string,",
				"          {Project Number} as string,",
				"          {Purchase Commod} as integer,",
				"          Qty as integer,",
				"          {Quantity In Process} as string,",
				"          {Receipt Routing} as string,",
				"          {Release Errors} as string,",
				"          {Release Time Fence Code} as string,",
				"          {Repetitive Type} as boolean,",
				"          {Report Date} as timestamp,",
				"          {Rescheduled Flag} as boolean,",
				"          {Schedule Group} as string,",
				"          {Source Org} as short,",
				"          {Source Schedule} as string,",
				"          {Source Table} as string,",
				"          Status as boolean,",
				"          {Status Code} as string,",
				"          {Sugg Dock Date} as date,",
				"          {Sugg Due Date} as date,",
				"          {Sugg Order Date} as date,",
				"          {Sugg Start Date} as date,",
				"          {Suggested Req Buyer} as string,",
				"          {Sum_Project Onhand Qty} as string,",
				"          Supplier as string,",
				"          {Supplier Code} as string,",
				"          {Supply Avail Date} as date,",
				"          {Task Number} as boolean,",
				"          {Transaction Id} as integer,",
				"          {Unit Number} as string,",
				"          {Using Assembly} as integer,",
				"          {Wip Supply Type} as string,",
				"          {Workflow Publishing Data} as string,",
				"          {Planning Group} as string,",
				"          {Hold Attribute} as string,",
				"          {Suggested Buyer Name} as string,",
				"          {Itemcatpur Category Desc} as string,",
				"          {Items$Comsec} as string,",
				"          {Item Revision Control Flag} as boolean,",
				"          {List Price Per Unit} as double,",
				"          {Lot Control Flag} as boolean,",
				"          {Serial Number Control Code} as string,",
				"          {Serial Starting Number} as string,",
				"          {Serial Starting Prefix} as string,",
				"          {Shelf Life Code} as string,",
				"          {Shelf Life Days} as boolean,",
				"          {Shrinkage Rate} as boolean,",
				"          {Track In Installed Base} as string,",
				"          {Variable Lead Time} as string,",
				"          {Purchase Commod Description} as string,",
				"          {Items$Vmi Item} as string,",
				"          {Items$Target Cost} as string,",
				"          {Hazard Class} as boolean,",
				"          {Hazard Class Description} as boolean,",
				"          {Hazardous Material Flag} as boolean,",
				"          {Item Replenishment Type} as string,",
				"          {Mtl Transactions Enabled Flag} as boolean,",
				"          {Minimum Order Quantity} as boolean,",
				"          {Items$Country Of Origin} as string,",
				"          {Solumina Security Group} as string,",
				"          {Items$Agile Access Restriction} as string,",
				"          {Repo Load Dttm} as timestamp,",
				"          {Right_Repo Load Dttm} as timestamp,",
				"          {Supply/Demand} as string,",
				"          {Supply Planning} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> MRPWorkbenchwithOnhandMRPearly",
				"MRPWorkbenchwithOnhandMRPearly select(mapColumn(",
				"          Action,",
				"          {Alternate Bom Designator},",
				"          {Alternate Routing Designator},",
				"          Applied,",
				"          {Avg Item Cost},",
				"          {Award Classification},",
				"          {Award Group},",
				"          {BOM Item Type},",
				"          {Build In Wip Flag},",
				"          {Build Sequence},",
				"          Buyer,",
				"          {Buyer Org},",
				"          {Buyer Type},",
				"          {Cfm Routing Flag},",
				"          {Change Notice},",
				"          {Component Revision},",
				"          {Compression Days},",
				"          {Cum Manufacturing Lead Time},",
				"          {Cumulative Total Lead Time},",
				"          Date,",
				"          {Date Published},",
				"          {Days From Today},",
				"          Division,",
				"          {Extended Cost},",
				"          {Extended Cost (ABS)},",
				"          {Firm Planned Type},",
				"          {First Unit Start Date},",
				"          {Fiscal Date},",
				"          {Fixed Lead Time},",
				"          {Full Pegging},",
				"          {Implement As Text},",
				"          {Implement Date},",
				"          {Implement Employee Id},",
				"          {Implement Quantity Rate},",
				"          {Implementation Date},",
				"          {Implemented Quantity},",
				"          {In Source Plan},",
				"          {Inventory Item Id},",
				"          {Item Avg Cost},",
				"          {Item Description},",
				"          {Item MRP Plan},",
				"          {Item Number},",
				"          {Item Planning Cat Code},",
				"          {Item Purchasable Flag},",
				"          {Item Rev},",
				"          {Item Status Code},",
				"          {Item Type},",
				"          {Last Unit Completion Date},",
				"          {Last Unit Start Date},",
				"          {Line Code},",
				"          {List Price},",
				"          {Locator Id},",
				"          {Lot Number},",
				"          {Lot Status},",
				"          {Make Buy},",
				"          Manager,",
				"          {Mrp Planning Method},",
				"          Nettable,",
				"          {New Date},",
				"          {New Quantity},",
				"          {Old Dock Date},",
				"          {Old Due Date},",
				"          {Old Order Quantity},",
				"          {On Hand Qty},",
				"          {Order Number},",
				"          {Order Type},",
				"          Org,",
				"          {Organization Id},",
				"          {Planner Code},",
				"          {Planning Group Quantity},",
				"          {PO Price},",
				"          {Postprocessing Lead Time},",
				"          {Preprocessing Lead Time},",
				"          {Process Days},",
				"          {Processing Lead Time},",
				"          {Product Line},",
				"          {Product Line Segment},",
				"          {Product Segment},",
				"          Project,",
				"          {Project Business Area},",
				"          {Project Manager Name},",
				"          {Project Name},",
				"          {Project Number},",
				"          {Purchase Commod},",
				"          Qty,",
				"          {Quantity In Process},",
				"          {Receipt Routing},",
				"          {Release Errors},",
				"          {Release Time Fence Code},",
				"          {Repetitive Type},",
				"          {Report Date},",
				"          {Rescheduled Flag},",
				"          {Schedule Group},",
				"          {Source Org},",
				"          {Source Schedule},",
				"          {Source Table},",
				"          Status,",
				"          {Status Code},",
				"          {Sugg Dock Date},",
				"          {Sugg Due Date},",
				"          {Sugg Order Date},",
				"          {Sugg Start Date},",
				"          {Suggested Req Buyer},",
				"          {Sum_Project Onhand Qty},",
				"          Supplier,",
				"          {Supplier Code},",
				"          {Supply Avail Date},",
				"          {Task Number},",
				"          {Transaction Id},",
				"          {Unit Number},",
				"          {Using Assembly},",
				"          {Wip Supply Type},",
				"          {Workflow Publishing Data},",
				"          {Planning Group},",
				"          {Hold Attribute},",
				"          {Suggested Buyer Name},",
				"          {Itemcatpur Category Desc},",
				"          {Items$Comsec},",
				"          {Item Revision Control Flag},",
				"          {List Price Per Unit},",
				"          {Lot Control Flag},",
				"          {Serial Number Control Code},",
				"          {Serial Starting Number},",
				"          {Serial Starting Prefix},",
				"          {Shelf Life Code},",
				"          {Shelf Life Days},",
				"          {Shrinkage Rate},",
				"          {Track In Installed Base},",
				"          {Variable Lead Time},",
				"          {Purchase Commod Description},",
				"          {Items$Vmi Item},",
				"          {Items$Target Cost},",
				"          {Hazard Class},",
				"          {Hazard Class Description},",
				"          {Hazardous Material Flag},",
				"          {Item Replenishment Type},",
				"          {Mtl Transactions Enabled Flag},",
				"          {Minimum Order Quantity},",
				"          {Items$Country Of Origin},",
				"          {Solumina Security Group},",
				"          {Items$Agile Access Restriction},",
				"          {Repo Load Dttm},",
				"          {Right_Repo Load Dttm},",
				"          {Supply/Demand},",
				"          {Supply Planning}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectingDesiredColumns",
				"selectingDesiredColumns filter({Supply/Demand} == 'Demand' && toString(Date) <= toString(addMonths(currentDate(),216)) && in(['30','75','10'],Org) && in(['_KIT','Kit','_PCD','RMFG FG','_VICD','_SOCD','_ALTERED ITEM','_COTS SOFTWARE','MFG finished good','finished good','Purchased finished good','Subassembly','_SUBASSEMBLY'],{Item Type})) ~> filteringDemand",
				"filteringDemand select(mapColumn(",
				"          Buyer,",
				"          Date,",
				"          {Extended Cost},",
				"          {Item Description},",
				"          {Item Number},",
				"          {Item Rev},",
				"          {Item Type},",
				"          {Make Buy},",
				"          {Order Number},",
				"          {Order Type},",
				"          Org,",
				"          {Planner Code},",
				"          {Planning Group Quantity},",
				"          {Postprocessing Lead Time},",
				"          {Preprocessing Lead Time},",
				"          {Processing Lead Time},",
				"          {Product Segment},",
				"          Project,",
				"          {Project Business Area},",
				"          {Project Name},",
				"          Qty,",
				"          {Task Number},",
				"          {Using Assembly},",
				"          {Supply/Demand}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectingFinalColumns",
				"selectingFinalColumns derive(Date = iif(toString(Date)>=substring(toString(currentDate()),1,8)+'01',substring(toString(Date),1,8)+'01',toString(null())),",
				"          {Past Due Flag} = iif(isNull(Date),'Y','N'),",
				"          Snapshot = toString(currentDate())) ~> AddingUpColumns",
				"AddingUpColumns aggregate(groupBy(Org,",
				"          {Item Description},",
				"          {Item Number},",
				"          {Make Buy},",
				"          Project,",
				"          {Task Number},",
				"          {Supply/Demand},",
				"          {Order Type},",
				"          {Past Due Flag},",
				"          Date,",
				"          Snapshot,",
				"          {Item Type}),",
				"     Qty = sum(Qty),",
				"          {# of Orders} = countDistinct({Order Number})) ~> CalculatingQtyCountOfOrderNumber",
				"CalculatingQtyCountOfOrderNumber derive(filepath = concat('MRP Demand Snapshot/output/','Top Level MRP Demand_',Snapshot,'.csv')) ~> derivedColumn1",
				"derivedColumn1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     rowUrlColumn:'filepath',",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sinkToCsv"
			]
		}
	}
}