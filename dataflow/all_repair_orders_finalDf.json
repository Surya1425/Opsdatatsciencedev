{
	"name": "all_repair_orders_finalDf",
	"properties": {
		"folder": {
			"name": "all_repair_orders"
		},
		"type": "Flowlet",
		"typeProperties": {
			"sources": [
				{
					"name": "CSD0"
				},
				{
					"name": "INVG0"
				},
				{
					"name": "PAG0"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "selectingCSD0Columns"
				},
				{
					"name": "selectingPAG0Columns"
				},
				{
					"name": "joiningCSD0PAG0LeftOuter1"
				},
				{
					"name": "selectingINVG0Columns"
				},
				{
					"name": "filteringOrgCodeMAS"
				},
				{
					"name": "finalSelectfromINVG0"
				},
				{
					"name": "joiningWithINVG0LeftOuter2"
				},
				{
					"name": "FormulaeApplied"
				},
				{
					"name": "selectingFinalOfFinal"
				},
				{
					"name": "filteringProjectNumber"
				},
				{
					"name": "ProductLineSecondFormula"
				},
				{
					"name": "selectingColumns"
				},
				{
					"name": "HistoricalData"
				}
			],
			"scriptLines": [
				"source(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     inferDriftedColumnTypes: true,",
				"     fileSystem: 'all-repair-orders',",
				"     folderPath: 'input',",
				"     fileName: 'CSDG0_Repair_Orders.csv',",
				"     columnDelimiter: ',',",
				"     escapeChar: '\\\\',",
				"     quoteChar: '\\\"',",
				"     columnNamesAsHeader: true) ~> CSD0",
				"source(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     fileSystem: 'all-repair-orders',",
				"     folderPath: 'input',",
				"     fileName: 'INVG0_Category_AMS_Category.csv',",
				"     columnDelimiter: ',',",
				"     escapeChar: '\\\\',",
				"     quoteChar: '\\\"',",
				"     columnNamesAsHeader: true) ~> INVG0",
				"source(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     fileSystem: 'all-repair-orders',",
				"     folderPath: 'input',",
				"     fileName: 'PAG0_Project_Class_Categories.csv',",
				"     columnDelimiter: ',',",
				"     escapeChar: '\\\\',",
				"     quoteChar: '\\\"',",
				"     columnNamesAsHeader: true) ~> PAG0",
				"CSD0 select(mapColumn(",
				"          {Warehouse Code},",
				"          {Unit Selling Price},",
				"          {Total Estimate Amount},",
				"          {Total Actual Amount},",
				"          {Times Returned},",
				"          {Time In Repair},",
				"          {Time In Open Status},",
				"          {Time In Hold Status},",
				"          Subinventory,",
				"          {Shipped Quantity},",
				"          {Ship To State},",
				"          {Ship To Postal Code},",
				"          {Ship To County},",
				"          {Ship To Country},",
				"          {Ship To City},",
				"          {Ship To Address4},",
				"          {Ship To Address3},",
				"          {Ship To Address2},",
				"          {Ship To Address1},",
				"          {Ship Date},",
				"          {Service Request Number},",
				"          {Salesforce Rma},",
				"          {Sr Status},",
				"          {Sr Severity},",
				"          {Sr Owner Name},",
				"          {Sr Operating Unit Name},",
				"          {Sr Item Serial Number},",
				"          {Sr Group Name},",
				"          {Repair Type Reference},",
				"          {Repair Type},",
				"          {Repair Status},",
				"          {Repair Reason},",
				"          {Repair Quantity},",
				"          {Repair Priority},",
				"          {Repair Owner Name},",
				"          {Repair Order Task},",
				"          {Repair Order Split Flag},",
				"          {Repair Order Promised Date},",
				"          {Repair Order Project},",
				"          {Repair Order Creation Date},",
				"          {Repair Order Closed Date},",
				"          {Repair Number},",
				"          {Repair Mode Code},",
				"          {Repair Line Id},",
				"          {Repair Item Uom},",
				"          {Repair Item Serial Number},",
				"          {Repair Currency Code},",
				"          {Repair$Vendor Rma},",
				"          {Repair$Vendor Name},",
				"          {Repair$Tail Number},",
				"          {Repair$Tat Adj Reason},",
				"          {Repair$Tat Adj},",
				"          {Repair$Service Affiliation},",
				"          {Repair$Ssl},",
				"          {Repair$Returning Platform},",
				"          {Repair$Program},",
				"          {Repair$Out Of Scope Repair Est},",
				"          {Repair$Metric Completion Date},",
				"          {Repair$Ecd},",
				"          {Repair$Customer Rl File Name},",
				"          {Repair$Cust Rl Trx Context Val},",
				"          {Repair$Cust Rl Original Failur},",
				"          {Repair$Cost Justification},",
				"          {Repair$Actual Start Date},",
				"          {Repair$Actual Repair Price},",
				"          {Repair$Actual Complete Date},",
				"          {Received Quantity},",
				"          {Receive Date},",
				"          {Rma Order Number},",
				"          {Quantity In Wip},",
				"          {Problem Description},",
				"          {Price List},",
				"          {Po Number},",
				"          Locator,",
				"          {Item Revision},",
				"          {Item Lot Number},",
				"          {Item Instance Status},",
				"          {Item Instance Number},",
				"          {Item Description},",
				"          {Item Number} = {Item$Sv$Part Number},",
				"          {Item$Organization Id},",
				"          {Item$Inventory Item Id},",
				"          {Inventory Organization Name},",
				"          {Internal Order Flag},",
				"          {Instance Warranty End Date},",
				"          {Install Site State},",
				"          {Install Site Postal Code},",
				"          {Install Site County},",
				"          {Install Site Country},",
				"          {Install Site City},",
				"          {Install Site Address4},",
				"          {Install Site Address3},",
				"          {Install Site Address2},",
				"          {Install Site Address1},",
				"          {Incident Type},",
				"          {Estimate Approval Status},",
				"          {Customer Type},",
				"          {Customer Product Id},",
				"          {Customer Phone},",
				"          {Customer Number},",
				"          {Customer Name},",
				"          {Contract Warranty End Date},",
				"          {Contract Number},",
				"          {Contract Line Id},",
				"          {Contact Type},",
				"          {Contact Relationship},",
				"          {Contact Phone},",
				"          {Contact Person Number},",
				"          {Contact Person Name},",
				"          {Bill To State},",
				"          {Bill To Postal Code},",
				"          {Bill To County},",
				"          {Bill To Country},",
				"          {Bill To City},",
				"          {Bill To Address4},",
				"          {Bill To Address3},",
				"          {Bill To Address2},",
				"          {Bill To Address1},",
				"          {Avg Addl Funds},",
				"          {Automatic Rma Process Flag},",
				"          {Approval Required Flag},",
				"          {Warranty Status},",
				"          {Repo Load Dttm}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectingCSD0Columns",
				"PAG0 select(mapColumn(",
				"          {Product Line Business Area},",
				"          {Project Number},",
				"          {Product Line}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectingPAG0Columns",
				"selectingCSD0Columns, selectingPAG0Columns join({Repair Order Project} == {Project Number},",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> joiningCSD0PAG0LeftOuter1",
				"INVG0 select(mapColumn(",
				"          {Item Status Code},",
				"          {Item Type},",
				"          {Master Organization Name},",
				"          Organization,",
				"          {Org Code} = {Organization Code},",
				"          {Organization Name},",
				"          {Cat$Custom Commodity Code},",
				"          {Cat$Default Category Lead Time},",
				"          {Cat$Metal Ranking Applies On B},",
				"          {Cat$Web Enabled Y N},",
				"          {Category Description},",
				"          {Chart Of Accounts Name},",
				"          {Item$Agile Access Restriction},",
				"          {Item$Agile Item  Part  Categor},",
				"          {Item$Asset Name},",
				"          {Item$Asset Nomenclature},",
				"          {Item$Asset Variant},",
				"          {Item$Bin Qty},",
				"          {Item$Build In Solumina Date},",
				"          {Item$Comsec},",
				"          {Item$Cui},",
				"          {Item$Country Of Origin},",
				"          {Item$Esd Handling},",
				"          {Item$Exclude From Lead Time Up},",
				"          {Item$External Systems},",
				"          {Item$Invoice Uom},",
				"          {Item$Item Net Weight  Lbs},",
				"          {Item$Item Setup Verified},",
				"          {Item$Lead Time Updated},",
				"          {Item$Legacy System Item Number},",
				"          {Item$Material Expiration Value},",
				"          {Item$Moisture Sensitivity Leve},",
				"          {Item$Non Mrp Actionable},",
				"          {Item$Replenishment Type},",
				"          {Item$Reserved Pn},",
				"          {Item$St Applies},",
				"          {Item$Space Flight Deliverable},",
				"          {Item$Storage Condition},",
				"          {Item$Target Cost},",
				"          {Item$Use As Required},",
				"          {Item$Vmi Item},",
				"          {Item$Warranty Period},",
				"          {Item$Inventory Item Id},",
				"          {Item$Organization Id},",
				"          {Item Number} = {Item$Sv$Part Number},",
				"          {Itemcat$Category Id},",
				"          {Itemcat$Sv$Ams},",
				"          {Item Description},",
				"          {Item Status},",
				"          {Repo Load Dttm}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectingINVG0Columns",
				"selectingINVG0Columns filter({Org Code}=='MAS') ~> filteringOrgCodeMAS",
				"filteringOrgCodeMAS select(mapColumn(",
				"          {Item Number},",
				"          {Itemcat$Sv$Ams}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> finalSelectfromINVG0",
				"joiningCSD0PAG0LeftOuter1, finalSelectfromINVG0 join(selectingCSD0Columns@{Item Number} == finalSelectfromINVG0@{Item Number},",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> joiningWithINVG0LeftOuter2",
				"selectingColumns derive({Repair$Actual Complete Date} = toString(toTimestamp({Repair$Actual Complete Date}, 'yyyy/MM/dd HH:mm:ss'),'yyyy-MM-dd HH:mm:ss'),",
				"          {Repair$Actual Start Date} = toString(toTimestamp({Repair$Actual Start Date}, 'yyyy/MM/dd HH:mm:ss'),'yyyy-MM-dd HH:mm:ss'),",
				"          {Product Line} = iif(isNull({Product Line}),'Unknown',{Product Line}),",
				"          report_date = toString(currentTimestamp(),'yyyy-MM-dd'),",
				"          {Business Area} = iif (contains(['75','76'],#item==toString({Warehouse Code})),'AS',iif(isNull({Product Line Business Area}),'Unknown',{Product Line Business Area})),",
				"          {Warranty Status} = iif(regexMatch({Repair Type},'OUT') || regexMatch({Repair Type},'OOW') || regexMatch({Repair Type},'Non'),'Out of Warranty',iif(regexMatch({Repair Type},'spare'),'Spare',iif(regexMatch({Repair Type},'CONTRACT'),'Contract Warranty','In Warranty'))),",
				"          {AMS Item Name} = iif(isNull({Itemcat$Sv$Ams}),'Unknown',{Itemcat$Sv$Ams})) ~> FormulaeApplied",
				"ProductLineSecondFormula select(mapColumn(",
				"          each(match(/* All input columns */true()),",
				"               /* Input name */$$ = $$)",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectingFinalOfFinal",
				"selectingFinalOfFinal filter(not(in(['2699997','2626981','2626991'],{Project Number}))) ~> filteringProjectNumber",
				"FormulaeApplied derive({Product Line} = replace({Product Line}, 'KG', 'SNS'),",
				"          {Ship Date} = iif({Project Number}=='8468140' && {Repair Status}=='Closed' && isNull({Ship Date}),{Repair$Actual Complete Date},{Ship Date})) ~> ProductLineSecondFormula",
				"joiningWithINVG0LeftOuter2 select(mapColumn(",
				"          {Warehouse Code},",
				"          {Unit Selling Price},",
				"          {Total Estimate Amount},",
				"          {Total Actual Amount},",
				"          {Times Returned},",
				"          {Time In Repair},",
				"          {Time In Open Status},",
				"          {Time In Hold Status},",
				"          Subinventory,",
				"          {Shipped Quantity},",
				"          {Ship To State},",
				"          {Ship To City},",
				"          {Ship To Address1},",
				"          {Ship Date},",
				"          {Service Request Number},",
				"          {Salesforce Rma},",
				"          {Sr Status},",
				"          {Sr Severity},",
				"          {Sr Operating Unit Name},",
				"          {Sr Item Serial Number},",
				"          {Sr Group Name},",
				"          {Repair Type Reference},",
				"          {Repair Type},",
				"          {Repair Status},",
				"          {Repair Reason},",
				"          {Repair Quantity},",
				"          {Repair Priority},",
				"          {Repair Owner Name},",
				"          {Repair Order Task},",
				"          {Repair Order Promised Date},",
				"          {Repair Order Project},",
				"          {Repair Order Creation Date},",
				"          {Repair Order Closed Date},",
				"          {Repair Number},",
				"          {Repair Line Id},",
				"          {Repair Item Uom},",
				"          {Repair Item Serial Number},",
				"          {Repair Currency Code},",
				"          {Repair$Vendor Name},",
				"          {Repair$Tail Number},",
				"          {Repair$Tat Adj Reason},",
				"          {Repair$Service Affiliation},",
				"          {Repair$Ssl},",
				"          {Repair$Returning Platform},",
				"          {Repair$Program},",
				"          {Repair$Metric Completion Date},",
				"          {Repair$Ecd},",
				"          {Repair$Cust Rl Trx Context Val},",
				"          {Repair$Cust Rl Original Failur},",
				"          {Repair$Actual Start Date},",
				"          {Repair$Actual Repair Price},",
				"          {Repair$Actual Complete Date},",
				"          {Received Quantity},",
				"          {Receive Date},",
				"          {Price List},",
				"          Locator,",
				"          {Item Revision},",
				"          {Item Lot Number},",
				"          {Item Instance Status},",
				"          {Item Instance Number},",
				"          {Item Description},",
				"          {Item Number} = selectingCSD0Columns@{Item Number},",
				"          {Item$Organization Id},",
				"          {Item$Inventory Item Id},",
				"          {Inventory Organization Name},",
				"          {Internal Order Flag},",
				"          {Instance Warranty End Date},",
				"          {Incident Type},",
				"          {Estimate Approval Status},",
				"          {Customer Type},",
				"          {Customer Product Id},",
				"          {Customer Name},",
				"          {Contract Warranty End Date},",
				"          {Contract Number},",
				"          {Avg Addl Funds},",
				"          {Warranty Status},",
				"          {Product Line Business Area},",
				"          {Project Number},",
				"          {Product Line},",
				"          {Itemcat$Sv$Ams},",
				"          {Rma Order Number}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectingColumns",
				"filteringProjectNumber output() ~> HistoricalData"
			]
		}
	}
}