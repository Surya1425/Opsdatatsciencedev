{
	"name": "DF_OracleCars",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_csv_input",
						"type": "DatasetReference"
					},
					"name": "QAG0CarDetailVsat",
					"description": "QAG0_Car_Detail_Vsat"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_csv_output",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "select1"
				},
				{
					"name": "select2"
				},
				{
					"name": "filter1"
				},
				{
					"name": "sort1"
				},
				{
					"name": "aggregate1"
				},
				{
					"name": "join2"
				},
				{
					"name": "derivedColumn1"
				},
				{
					"name": "select3"
				}
			],
			"scriptLines": [
				"source(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> QAG0CarDetailVsat",
				"QAG0CarDetailVsat select(mapColumn(",
				"          each(match(true()),",
				"               iif(startsWith($$,'Car'),substring($$,4,length($$)),$$) = $$)",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1 select(mapColumn(",
				"          { Effectiveness},",
				"          {Detailed Description} = { Detailed Desc},",
				"          {Det Response Received} = { Det Resp Recd},",
				"          {Det Response Due Date} = { Det Resp Due Date},",
				"          { Det Planned Date},",
				"          {Det Line Number} = { Det Line No},",
				"          { Det Last Update Date},",
				"          { Det Creation Date},",
				"          { Det Comments},",
				"          {Det Action Status} = { Det Car Action Stat},",
				"          { Det Assigned To User},",
				"          {Det Assigned To Supplier} = { Det Assigned To Supp},",
				"          { Det Action Type},",
				"          { Det Action Results},",
				"          {Det Action Description} = { Det Action Desc},",
				"          {Det Action Date} = { Det Act Date},",
				"          { Date Opened},",
				"          { Date Closed},",
				"          { Customer},",
				"          { Creation Date},",
				"          { Comments},",
				"          { Collection},",
				"          Type = { Car Type},",
				"          Status = { Car Stat},",
				"          {CAR Number} = { Car No},",
				"          {Affected Process} = { Aff Proc},",
				"          {Where Found},",
				"          {Systemic Flag},",
				"          {Repeat Flag},",
				"          {Program Area},",
				"          {Org Code} = {Organization Code},",
				"          {Keyword Tags},",
				"          { Supplier},",
				"          {Suggested Action} = { Sugg Action},",
				"          { Severity} = { Sev},",
				"          {Reference Document} = { Ref Doc},",
				"          { Reason},",
				"          { Originator},",
				"          { Last Update Date},",
				"          {CAR Flex LOV 1} = { Flex Lov Car 1},",
				"          {Repo Load Dttm}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select2",
				"select2 filter(!isNull({ Det Assigned To User}) &&\r",
				"{ Det Action Type} == 'Corrective Actions') ~> filter1",
				"filter1 sort(asc({Det Line Number}, true)) ~> sort1",
				"sort1 aggregate(groupBy({Det Line Number}),",
				"     each(match(name!='Det Line Number'), $$ = first($$))) ~> aggregate1",
				"select2, aggregate1 join(select2@{CAR Number} == aggregate1@{CAR Number},",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join2",
				"select3 derive({Header Supplier Name} = iif (isNull(Supplier), {Right_Det Assigned To Supplier}, Supplier ),",
				"          {Calendar Quarter} = iif( dayOfMonth({Date Opened}) == 1|| \r",
				"dayOfMonth({Date Opened}) == 2||\r",
				"dayOfMonth({Date Opened}) == 3 \r",
				", concat(toString(year({Date Opened})) , \"Q1\"),\r",
				"iif( dayOfMonth({Date Opened}) == 4|| \r",
				"dayOfMonth({Date Opened}) == 5||\r",
				"dayOfMonth({Date Opened}) == 6 \r",
				", concat(toString(year({Date Opened})) , \"Q2\"),\r",
				"iif( dayOfMonth({Date Opened}) == 7|| \r",
				"dayOfMonth({Date Opened}) == 8||\r",
				"dayOfMonth({Date Opened}) == 9 \r",
				", concat(toString(year({Date Opened})) , \"Q3\"),\r",
				"iif( dayOfMonth({Date Opened}) == 10|| \r",
				"dayOfMonth({Date Opened}) == 11 ||\r",
				"dayOfMonth({Date Opened}) == 12\r",
				", concat(toString(year({Date Opened})) , \"Q4\"),\"ERR||\")))),",
				"          {Fiscal Quarter} = iif( dayOfMonth({Date Opened}) == 1|| \r",
				"dayOfMonth({Date Opened}) == 2||\r",
				"dayOfMonth({Date Opened}) == 3 \r",
				", concat(toString(year({Date Opened})) , \"Q4\"),\r",
				"iif( dayOfMonth({Date Opened}) == 4|| \r",
				"dayOfMonth({Date Opened}) == 5||\r",
				"dayOfMonth({Date Opened}) == 6 \r",
				", concat(toString(year(addMonths({Date Opened},12))) , \"Q1\"),\r",
				"iif( dayOfMonth({Date Opened}) == 7|| \r",
				"dayOfMonth({Date Opened}) == 8||\r",
				"dayOfMonth({Date Opened}) == 9 \r",
				", concat(toString(year(addMonths({Date Opened},12))) , \"Q2\"),\r",
				"iif( dayOfMonth({Date Opened}) == 10|| \r",
				"dayOfMonth({Date Opened}) == 11 ||\r",
				"dayOfMonth({Date Opened}) == 12\r",
				", concat(toString(year(addMonths({Date Opened},12))) , \"Q3\"),'ERROR')))),",
				"          {Workflow Generating Data} = \"workflow name\",",
				"          {Business Segment} = substring(Comments,instr(Comments,'[')+1, \r",
				"                   instr(Comments,']')-(instr(Comments,'[')-1)\r",
				"                   )) ~> derivedColumn1",
				"join2 select(mapColumn(",
				"          Effectiveness = select2@{ Effectiveness},",
				"          {Detailed Description} = select2@{Detailed Description},",
				"          {Det Response Received} = select2@{Det Response Received},",
				"          {Det Response Due Date} = select2@{Det Response Due Date},",
				"          {Det Planned Date} = select2@{ Det Planned Date},",
				"          {Det Line Number} = select2@{Det Line Number},",
				"          {Det Last Update Date} = select2@{ Det Last Update Date},",
				"          {Det Creation Date} = select2@{ Det Creation Date},",
				"          {Det Comments} = select2@{ Det Comments},",
				"          {Det Action Status} = select2@{Det Action Status},",
				"          {Det Assigned To User} = select2@{ Det Assigned To User},",
				"          {Det Assigned To Supplier} = select2@{Det Assigned To Supplier},",
				"          {Det Action Type} = select2@{ Det Action Type},",
				"          {Det Action Results} = select2@{ Det Action Results},",
				"          {Det Action Description} = select2@{Det Action Description},",
				"          {Det Action Date} = select2@{Det Action Date},",
				"          {Date Opened} = select2@{ Date Opened},",
				"          {Date Closed} = select2@{ Date Closed},",
				"          Customer = select2@{ Customer},",
				"          {Creation Date} = select2@{ Creation Date},",
				"          Comments = select2@{ Comments},",
				"          Collection = select2@{ Collection},",
				"          Type = select2@Type,",
				"          Status = select2@Status,",
				"          {CAR Number} = select2@{CAR Number},",
				"          {Affected Process} = select2@{Affected Process},",
				"          {Where Found} = select2@{Where Found},",
				"          {Systemic Flag} = select2@{Systemic Flag},",
				"          {Repeat Flag} = select2@{Repeat Flag},",
				"          {Program Area} = select2@{Program Area},",
				"          {Org Code} = select2@{Org Code},",
				"          {Keyword Tags} = select2@{Keyword Tags},",
				"          Supplier = select2@{ Supplier},",
				"          {Suggested Action} = select2@{Suggested Action},",
				"          Severity = select2@{ Severity},",
				"          {Reference Document} = select2@{Reference Document},",
				"          Reason = select2@{ Reason},",
				"          Originator = select2@{ Originator},",
				"          {Last Update Date} = select2@{ Last Update Date},",
				"          {CAR Flex LOV 1} = select2@{CAR Flex LOV 1},",
				"          {Repo Load Dttm} = select2@{Repo Load Dttm},",
				"          {Right_Det Assigned To Supplier} = aggregate1@{Det Assigned To Supplier}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select3",
				"derivedColumn1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sink1"
			]
		}
	}
}